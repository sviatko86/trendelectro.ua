<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trend Electro ‚Äî –û–ø—Ç–æ–≤–∏–π –ø—Ä–∞–π—Å</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .cart-badge { position: absolute; top: -8px; right: -8px; background: #ef4444; color: white; border-radius: 50%; padding: 2px 6px; font-size: 10px; font-weight: bold; }
        .admin-only { display: none; background: #fef3c7; border: 2px dashed #f59e0b; }
        .product-img { width: 65px; height: 65px; object-fit: cover; border-radius: 12px; background: #f3f4f6; transition: transform 0.2s; }
        .product-img:hover { transform: scale(1.1); }
        .hidden { display: none; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background: #eab308; border-radius: 10px; }
        .animate-fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans">

    <nav class="bg-yellow-500 p-4 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black text-white tracking-tighter uppercase">Trend Electro</h1>
            <div class="flex gap-5 items-center">
                <button onclick="loginAdmin()" class="text-white opacity-20 hover:opacity-100 transition"><i class="fas fa-lock"></i></button>
                <button onclick="toggleCabinet()" class="text-white text-xl hover:scale-110 transition"><i class="fas fa-user-circle"></i></button>
                <button onclick="toggleCart()" class="relative text-white text-xl hover:scale-110 transition">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cart-count" class="cart-badge">0</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4 max-w-5xl">
        
        <div id="admin-panel" class="admin-only p-4 rounded-2xl mb-6 shadow-inner text-sm text-yellow-800 font-bold">
            ‚öôÔ∏è –ü–ê–ù–ï–õ–¨ –ö–ï–†–£–í–ê–ù–ù–Ø | –¢–û–í–ê–†–Ü–í –£ –ë–ê–ó–Ü: <span id="admin-total-count">0</span>
        </div>

        <div class="relative mb-8">
            <input type="text" id="search" placeholder="–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—É –∞–±–æ –∞—Ä—Ç–∏–∫—É–ª—É..." 
                class="w-full p-5 pl-12 rounded-2xl border-none shadow-lg focus:ring-4 focus:ring-yellow-300 transition text-lg">
            <i class="fas fa-search absolute left-4 top-6 text-gray-400"></i>
        </div>

        <div id="cabinet" class="hidden bg-white p-6 rounded-2xl shadow-xl mb-8 border-l-8 border-yellow-500 animate-fade-in">
            <h2 class="text-xl font-bold mb-4">–î–∞–Ω—ñ –∫–ª—ñ—î–Ω—Ç–∞</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="user-name" placeholder="–ü–Ü–ë –∞–±–æ –ù–∞–∑–≤–∞ –∫–æ–º–ø–∞–Ω—ñ—ó" class="p-3 bg-gray-100 rounded-xl border-none focus:ring-2 focus:ring-yellow-400">
                <input type="text" id="user-phone" placeholder="–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∏–π —Ç–µ–ª–µ—Ñ–æ–Ω" class="p-3 bg-gray-100 rounded-xl border-none focus:ring-2 focus:ring-yellow-400">
            </div>
            <button onclick="saveProfile()" class="mt-4 bg-yellow-500 text-white font-bold py-3 px-10 rounded-xl hover:bg-yellow-600 transition shadow-md">–ó–±–µ—Ä–µ–≥—Ç–∏ –¥–∞–Ω—ñ</button>
        </div>

        <div class="bg-white rounded-3xl shadow-xl overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-100 border-b">
                        <tr>
                            <th class="p-4 text-xs font-bold text-gray-400 uppercase">–§–æ—Ç–æ</th>
                            <th class="p-4 text-xs font-bold text-gray-400 uppercase">–¢–æ–≤–∞—Ä</th>
                            <th class="p-4 text-xs font-bold text-gray-400 uppercase text-right">–¶—ñ–Ω–∞ (–≥—Ä–Ω)</th>
                            <th class="p-4 text-xs font-bold text-gray-400 uppercase text-center">–ó–∞–º–æ–≤–∏—Ç–∏</th>
                        </tr>
                    </thead>
                    <tbody id="product-list" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="cart-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-[100] flex justify-end transition-all">
        <div class="bg-white w-full max-w-md h-full p-8 overflow-y-auto shadow-2xl flex flex-col">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-3xl font-black text-yellow-600 uppercase tracking-tighter">–ö–æ—à–∏–∫</h2>
                <button onclick="toggleCart()" class="text-4xl text-gray-300 hover:text-gray-600">&times;</button>
            </div>
            
            <div id="cart-items" class="space-y-4 flex-grow"></div>
            
            <div class="mt-8 pt-6 border-t-2 border-gray-100">
                <div class="flex justify-between text-lg text-gray-500 font-medium"><span>–°—É–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</span><span id="total-price">0 –≥—Ä–Ω</span></div>
                <div id="discount-info" class="text-green-600 font-bold text-sm mt-1"></div>
                <div class="flex justify-between text-3xl font-black mt-4 text-red-600">
                    <span>–í–°–¨–û–ì–û:</span><span id="final-price">0 –≥—Ä–Ω</span>
                </div>
                <button onclick="checkout()" class="w-full bg-green-500 text-white py-5 rounded-2xl mt-8 font-black text-xl hover:bg-green-600 transition shadow-lg active:scale-95 uppercase tracking-wide">
                    –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è
                </button>
            </div>
        </div>
    </div>

    <script>
        let products = [];
        let cart = JSON.parse(localStorage.getItem('trend_cart') || '{}');

        async function init() {
            try {
                // nocache –≥–∞—Ä–∞–Ω—Ç—É—î, —â–æ –±–∞–∑–∞ –∑–∞–≤–∂–¥–∏ —Å–≤—ñ–∂–∞
                const res = await fetch('data.csv?v=' + new Date().getTime());
                const text = await res.text();
                const lines = text.split(/\r?\n/).filter(l => l.trim() !== "");
                
                products = lines.slice(1).map(line => {
                    const parts = line.split(',');
                    if (parts.length < 2) return null;

                    const sku = parts[0].replace(/"/g, '').trim();
                    const rawPrice = parseFloat(parts[parts.length - 1]);
                    // –°–∫–ª–µ—é—î–º–æ –Ω–∞–∑–≤—É, —è–∫—â–æ –≤ –Ω—ñ–π –±—É–ª–∏ –∫–æ–º–∏
                    let name = parts.slice(1, -1).join(', ').replace(/"/g, '').trim();
                    
                    if (!isNaN(rawPrice)) {
                        const price = Math.round(rawPrice * 1.5); // –¢–≤–æ—è –Ω–∞—Ü—ñ–Ω–∫–∞ +50%
                        return { sku, name, price };
                    }
                    return null;
                }).filter(p => p !== null);

                document.getElementById('admin-total-count').innerText = products.length;
                renderProducts(products);
                updateCartUI();
            } catch (e) { 
                console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö"); 
            }
        }

        function renderProducts(items) {
            const list = document.getElementById('product-list');
            list.innerHTML = items.map(p => `
                <tr class="hover:bg-yellow-50/50 transition">
                    <td class="p-4 w-20">
                        <img src="img/${p.sku}.jpg" onerror="this.src='https://via.placeholder.com/150?text=Trend'" class="product-img border shadow-sm">
                    </td>
                    <td class="p-4">
                        <p class="text-[10px] text-gray-300 font-mono tracking-widest uppercase">${p.sku}</p>
                        <p class="font-bold text-gray-800 leading-tight">${p.name}</p>
                    </td>
                    <td class="p-4 text-right font-black text-yellow-600 text-lg tracking-tighter">${p.price}</td>
                    <td class="p-4">
                        <div class="flex items-center justify-center gap-2 bg-gray-100 rounded-full p-1 border border-gray-200">
                            <button onclick="updateCart('${p.sku}', -1)" class="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow-sm hover:text-red-500 transition">-</button>
                            <span id="qty-${p.sku}" class="font-bold w-7 text-center text-lg">${cart[p.sku] || 0}</span>
                            <button onclick="updateCart('${p.sku}', 1)" class="w-8 h-8 flex items-center justify-center bg-yellow-400 text-white rounded-full shadow-sm hover:bg-yellow-500 transition">+</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function updateCart(sku, delta) {
            cart[sku] = (cart[sku] || 0) + delta;
            if (cart[sku] <= 0) delete cart[sku];
            localStorage.setItem('trend_cart', JSON.stringify(cart));
            const qtyLabel = document.getElementById(`qty-${sku}`);
            if (qtyLabel) qtyLabel.innerText = cart[sku] || 0;
            updateCartUI();
        }

        function updateCartUI() {
            let total = 0;
            const container = document.getElementById('cart-items');
            container.innerHTML = '';
            
            for (let sku in cart) {
                const p = products.find(i => i.sku === sku);
                if (!p) continue;
                const sum = p.price * cart[sku];
                total += sum;
                container.innerHTML += `
                    <div class="flex items-center gap-3 bg-gray-50 p-3 rounded-2xl border border-gray-100 animate-fade-in">
                        <img src="img/${p.sku}.jpg" onerror="this.src='https://via.placeholder.com/100?text=Trend'" class="w-12 h-12 rounded-lg object-cover shadow-sm">
                        <div class="flex-1">
                            <p class="font-bold text-[13px] leading-tight text-gray-700">${p.name}</p>
                            <p class="text-[11px] text-gray-400 mt-1">${cart[sku]} —à—Ç. x ${p.price} –≥—Ä–Ω</p>
                        </div>
                        <p class="font-black text-yellow-600 text-sm whitespace-nowrap">${sum} –≥—Ä–Ω</p>
                    </div>`;
            }

            let discount = total >= 10000 ? 0.05 : (total >= 5000 ? 0.03 : 0);
            let final = Math.round(total * (1 - discount));
            
            document.getElementById('cart-count').innerText = Object.values(cart).reduce((a, b) => a + b, 0);
            document.getElementById('total-price').innerText = total + " –≥—Ä–Ω";
            document.getElementById('final-price').innerText = final + " –≥—Ä–Ω";
            document.getElementById('discount-info').innerText = discount > 0 ? `–ê–∫—Ç–∏–≤–æ–≤–∞–Ω–æ –≥—É—Ä—Ç–æ–≤—É –∑–Ω–∏–∂–∫—É ${discount*100}%` : "";
        }

        async function checkout() {
            const user = JSON.parse(localStorage.getItem('trend_user') || '{}');
            if (!user.name || !user.phone) { 
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∫–∞–∂—ñ—Ç—å –≤–∞—à–µ —ñ–º'—è —Ç–∞ —Ç–µ–ª–µ—Ñ–æ–Ω —É —Ä–æ–∑–¥—ñ–ª—ñ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤ (—ñ–∫–æ–Ω–∫–∞ –∑–≤–µ—Ä—Ö—É)!"); 
                toggleCabinet(); 
                return; 
            }

            if (Object.keys(cart).length === 0) {
                alert("–í–∞—à –∫–æ—à–∏–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π!");
                return;
            }

            const botToken = '6918546766:AAEWLatU6fz6ITX8OI81Hd6nrMc-jE8u5cU';
            const chatId = '1246930818'; 

            let msg = `üöÄ TREND ELECTRO ‚Äî –ù–û–í–ï –ó–ê–ú–û–í–õ–ï–ù–ù–Ø\n\n`;
            msg += `üë§ –ö–ª—ñ—î–Ω—Ç: ${user.name}\n`;
            msg += `üìû –¢–µ–ª: ${user.phone}\n`;
            msg += `--------------------------\n`;

            for (let sku in cart) {
                const p = products.find(i => i.sku === sku);
                if (p) {
                    msg += `üîπ ${p.name}\n   –ê—Ä—Ç: ${p.sku} | ${cart[sku]} —à—Ç. | ${p.price * cart[sku]} –≥—Ä–Ω\n\n`;
                }
            }
            msg += `--------------------------\n`;
            msg += `üí∞ –ü–Ü–î–°–£–ú–û–ö: ${document.getElementById('final-price').innerText}`;

            try {
                const response = await fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: chatId, text: msg })
                });

                if (response.ok) {
                    alert("‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ! –û—á—ñ–∫—É–π—Ç–µ –Ω–∞ –¥–∑–≤—ñ–Ω–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞.");
                    cart = {}; 
                    localStorage.setItem('trend_cart', '{}'); 
                    updateCartUI(); 
                    toggleCart();
                    window.scrollTo(0, 0);
                } else { throw new Error(); }
            } catch (e) {
                alert("‚ùå –ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç –∞–±–æ –∑–≤'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞–º–∏ –Ω–∞–ø—Ä—è–º—É.");
            }
        }

        document.getElementById('search').addEventListener('input', (e) => {
            const t = e.target.value.toLowerCase();
            renderProducts(products.filter(p => p.name.toLowerCase().includes(t) || p.sku.toLowerCase().includes(t)));
        });

        function saveProfile() {
            const name = document.getElementById('user-name').value;
            const phone = document.getElementById('user-phone').value;
            if (name && phone) {
                localStorage.setItem('trend_user', JSON.stringify({ name, phone }));
                alert("–î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!"); 
                toggleCabinet();
            } else {
                alert("–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–∏–¥–≤–∞ –ø–æ–ª—è.");
            }
        }

        function loginAdmin() { if (prompt("–í—Ö—ñ–¥ –≤ —Å–∏—Å—Ç–µ–º—É:") === "admin123") document.getElementById('admin-panel').style.display='block'; }
        function toggleCart() { document.getElementById('cart-modal').classList.toggle('hidden'); }
        function toggleCabinet() { document.getElementById('cabinet').classList.toggle('hidden'); }
        
        window.onload = init;
    </script>
</body>
</html>
