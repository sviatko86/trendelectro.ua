<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trend Electro — Debug Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; p: 20px; }
        #debug-log { background: #000; color: #0f0; padding: 15px; border-radius: 10px; font-family: monospace; font-size: 12px; margin-bottom: 20px; border: 1px solid #334155; }
        .error { color: #ff4444; font-weight: bold; }
    </style>
</head>
<body>

    <div class="max-w-2xl mx-auto pt-10">
        <h1 class="text-2xl font-black mb-4">Trend <span class="text-yellow-400">Electro</span> Status</h1>
        
        <div id="debug-log">
            > Очікування запуску...<br>
        </div>

        <div id="grid" class="grid grid-cols-2 gap-4"></div>
    </div>

<script>
    const log = document.getElementById('debug-log');
    
    function addLog(msg, isError = false) {
        log.innerHTML += `<span class="${isError ? 'error' : ''}">${isError ? '❌' : '✅'} ${msg}</span><br>`;
    }

    async function start() {
        addLog("Спроба знайти файл data.csv...");
        
        try {
            const response = await fetch('data.csv?v=' + Date.now());
            
            if (!response.ok) {
                addLog(`Файл не знайдено! Статус: ${response.status}`, true);
                addLog("ПЕРЕВІР: Чи файл на GitHub називається саме data.csv (маленькими літерами)?", true);
                return;
            }
            
            addLog("Файл знайдено. Читаю текст...");
            const text = await response.text();
            
            if (!text || text.length < 10) {
                addLog("Файл порожній або занадто малий!", true);
                return;
            }
            
            addLog(`Отримано ${text.length} символів. Починаю розбір рядків...`);
            const lines = text.split('\n').filter(l => l.trim() !== "");
            addLog(`Знайдено рядків: ${lines.length}`);

            let html = "";
            let count = 0;

            lines.forEach((line, i) => {
                if (i === 0) return; // пропуск шапки

                // Спроба розбити по комі
                const parts = line.split(',');
                if (parts.length >= 2) {
                    const sku = parts[0].trim();
                    const priceRaw = parts[parts.length - 1].replace(/[^0-9.]/g, '');
                    const price = parseFloat(priceRaw);
                    const name = parts.slice(1, -1).join(', ').trim() || "Без назви";

                    if (!isNaN(price)) {
                        const finalPrice = Math.round(price * 1.5);
                        html += `
                            <div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                <div class="text-[10px] text-slate-500">${sku}</div>
                                <div class="text-xs font-bold mb-2">${name}</div>
                                <div class="text-yellow-400 font-black">${finalPrice} грн</div>
                            </div>
                        `;
                        count++;
                    }
                }
            });

            if (count === 0) {
                addLog("НЕ ВДАЛОСЯ розпізнати жодного товару. Перевір формат CSV!", true);
            } else {
                addLog(`Успішно завантажено товарів: ${count}`);
                document.getElementById('grid').innerHTML = html;
                log.style.borderColor = "#22c55e"; // Зелений колір, якщо все ок
            }

        } catch (err) {
            addLog(`Критична помилка коду: ${err.message}`, true);
        }
    }

    start();
</script>
</body>
</html>
