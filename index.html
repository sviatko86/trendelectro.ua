<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trend Electro — Каталог</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; background-color: #0f172a; color: white; }
    </style>
</head>
<body class="pb-32">

<header class="bg-slate-800 p-4 sticky top-0 z-50 border-b border-slate-700">
    <div class="container mx-auto flex justify-between items-center">
        <h1 class="text-xl font-black uppercase italic italic">Trend <span class="text-yellow-500">Electro</span></h1>
        <div id="cartCount" class="bg-yellow-400 text-black px-4 py-1 rounded-full font-bold">0</div>
    </div>
</header>

<main class="container mx-auto px-4 py-10">
    <div id="loader" class="text-center">
        <div class="inline-block animate-spin mb-4 text-yellow-400 text-4xl"><i class="fas fa-spinner"></i></div>
        <p id="status" class="text-slate-400 font-bold uppercase tracking-widest text-xs">Завантаження...</p>
        <div id="debug" class="mt-10 p-4 bg-black/50 rounded-xl text-left text-[10px] font-mono text-green-400 hidden overflow-auto max-h-60"></div>
    </div>
    <div id="grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>
</main>

<script>
    const MARKUP = 1.5;
    let products = [];

    async function loadData() {
        const status = document.getElementById('status');
        const debug = document.getElementById('debug');
        
        try {
            debug.classList.remove('hidden');
            debug.innerHTML += "> Спроба завантажити data.csv...<br>";
            
            const response = await fetch('data.csv?v=' + Date.now());
            
            debug.innerHTML += "> Статус відповіді: " + response.status + " " + response.statusText + "<br>";
            
            if (!response.ok) throw new Error("Файл не знайдено на сервері");

            const text = await response.text();
            debug.innerHTML += "> Отримано тексту: " + text.length + " символів<br>";
            debug.innerHTML += "> Перші 50 символів: " + text.substring(0, 50).replace(/\n/g, ' [Enter] ') + "<br>";

            const rows = text.split('\n').filter(r => r.trim() !== "");
            debug.innerHTML += "> Знайдено рядків: " + rows.length + "<br>";

            products = rows.map((row, index) => {
                if (index === 0) return null; // Пропускаємо шапку

                // Пробуємо різні розділювачі: Табуляція, потім Кома
                let cols = row.split('\t');
                if (cols.length < 2) cols = row.split(',');

                if (cols.length < 2) return null;

                const sku = cols[0].trim();
                const priceRaw = cols[cols.length - 1].replace(',', '.').trim();
                const priceBase = parseFloat(priceRaw);
                const name = cols.slice(1, -1).join(', ').trim() || cols[1];

                if (!isNaN(priceBase)) {
                    return { sku, name, price: Math.round(priceBase * MARKUP) };
                }
                return null;
            }).filter(p => p !== null);

            debug.innerHTML += "> Успішно оброблено товарів: " + products.length + "<br>";

            if (products.length > 0) {
                document.getElementById('loader').classList.add('hidden');
                render();
            } else {
                status.innerText = "Товари не розпізнані. Перевір формат файлу.";
            }

        } catch (e) {
            status.innerHTML = "<span class='text-red-500'>ПОМИЛКА!</span>";
            debug.innerHTML += "<br><span class='text-red-500'>!!! ПОМИЛКА: " + e.message + "</span>";
        }
    }

    function render() {
        const grid = document.getElementById('grid');
        grid.innerHTML = products.map(p => `
            <div class="bg-slate-800 p-4 rounded-2xl border border-slate-700">
                <div class="text-[9px] text-slate-500 font-bold uppercase">${p.sku}</div>
                <div class="text-sm font-bold my-2 h-10 overflow-hidden">${p.name}</div>
                <div class="flex justify-between items-center mt-4">
                    <div class="text-xl font-black text-yellow-500">${p.price} грн</div>
                    <button class="bg-yellow-400 text-black p-2 rounded-lg text-xs font-bold">В кошик</button>
                </div>
            </div>
        `).join('');
    }

    window.onload = loadData;
</script>
</body>
</html>
