<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trend Electro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body class="bg-slate-900 text-white">
 
    <header class="p-6 bg-slate-800 border-b border-white/5">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-black italic uppercase">Trend <span class="text-yellow-500">Electro</span></h1>
            <div class="flex gap-4">
                <button onclick="loginAdmin()" class="opacity-20 hover:opacity-100"><i class="fas fa-user-shield"></i></button>
                <button onclick="toggleCart()" class="relative">
                    <i class="fas fa-shopping-cart text-xl"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-[10px] w-5 h-5 flex items-center justify-center rounded-full font-bold">0</span>
                </button>
            </div>
        </div>
    </header>
 
    <main class="container mx-auto px-4 py-8">
        <div id="admin-panel" class="hidden bg-slate-800 p-6 rounded-2xl mb-8 border border-yellow-500/30">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-xs uppercase opacity-50">–ù–∞—Ü—ñ–Ω–∫–∞ (–Ω–∞–ø—Ä. 1.5)</label>
                    <input type="number" id="markup" step="0.1" onchange="updateSettings()" class="w-full bg-slate-700 p-2 rounded mt-1">
                </div>
                <div>
                    <label class="text-xs uppercase opacity-50">–ó–Ω–∏–∂–∫–∞ %</label>
                    <input type="number" id="global-discount" onchange="updateSettings()" class="w-full bg-slate-700 p-2 rounded mt-1">
                </div>
            </div>
        </div>
 
        <div id="loading" class="text-center py-20"><i class="fas fa-spinner fa-spin text-3xl"></i></div>
        <div id="product-list" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
    </main>
 
    <div id="cart-modal" class="hidden fixed inset-0 bg-black/90 backdrop-blur-md z-50 flex items-center justify-center p-4">
        <div class="bg-slate-800 w-full max-w-lg rounded-3xl p-8 border border-white/10">
            <h2 class="text-2xl font-black mb-6">–ö–û–®–ò–ö</h2>
            <div id="cart-items" class="space-y-4 max-h-96 overflow-y-auto mb-6"></div>
            <div class="flex justify-between items-center text-xl font-bold mb-6">
                <span>–†–∞–∑–æ–º:</span>
                <span id="final-price" class="text-yellow-500">0 –≥—Ä–Ω</span>
            </div>
            <div class="flex gap-2">
                <button onclick="toggleCart()" class="flex-1 bg-white/10 py-4 rounded-xl">–ó–∞–∫—Ä–∏—Ç–∏</button>
                <button onclick="checkout()" class="flex-[2] bg-yellow-500 text-black py-4 rounded-xl font-black uppercase">–ó–∞–º–æ–≤–∏—Ç–∏</button>
            </div>
        </div>
    </div>
 
    <script>
        let products = [];
        let cart = JSON.parse(localStorage.getItem('trend_cart') || '{}');
        let settings = JSON.parse(localStorage.getItem('trend_settings') || '{"discount": 0, "markup": 1.5}');
 
        async function init() {
            try {
                const res = await fetch('data.csv?v=' + Date.now());
                const text = await res.text();
                const lines = text.split('\n');
                
                products = lines.slice(1).map(line => {
                    const parts = line.split(',');
                    if (parts.length < 2) return null;
                    const sku = parts[0].trim();
                    const rawPrice = parseFloat(parts[parts.length - 1]);
                    const name = parts.slice(1, -1).join(',').replace(/"/g, '').trim();
                    
                    let price = Math.round(rawPrice * settings.markup);
                    if (settings.discount > 0) price = Math.round(price * (1 - settings.discount / 100));
 
                    return { sku, name, price };
                }).filter(p => p !== null);
 
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('markup').value = settings.markup;
                document.getElementById('global-discount').value = settings.discount;
                render();
            } catch (e) { console.error("Error loading products:", e); }
        }
 
        function render() {
            const list = document.getElementById('product-list');
            list.innerHTML = products.map(p => `
                <div class="bg-slate-800 p-4 rounded-2xl border border-white/5">
                    <img src="img/${p.sku}.jpg" onerror="this.src='https://via.placeholder.com/200'" class="w-full aspect-square object-contain bg-white rounded-lg mb-4">
                    <h3 class="font-bold text-sm mb-4 h-10 line-clamp-2">${p.name}</h3>
                    <div class="flex justify-between items-center">
                        <span class="text-lg font-black text-yellow-500">${p.price} –≥—Ä–Ω</span>
                        <div class="flex items-center gap-2">
                            <button onclick="updateCart('${p.sku}', -1)" class="w-8 h-8 bg-white/5 rounded-full">-</button>
                            <span class="w-4 text-center font-bold">${cart[p.sku] || 0}</span>
                            <button onclick="updateCart('${p.sku}', 1)" class="w-8 h-8 bg-yellow-500 text-black rounded-full">+</button>
                        </div>
                    </div>
                </div>
            `).join('');
            document.getElementById('cart-count').innerText = Object.values(cart).reduce((a,b) => a+b, 0);
        }
 
        function updateCart(sku, d) {
            cart[sku] = (cart[sku] || 0) + d;
            if (cart[sku] <= 0) delete cart[sku];
            localStorage.setItem('trend_cart', JSON.stringify(cart));
            render();
            updateCartUI();
        }
 
        function updateCartUI() {
            const cont = document.getElementById('cart-items');
            let total = 0; cont.innerHTML = '';
            for (let sku in cart) {
                const p = products.find(i => i.sku === sku);
                if (!p) continue;
                total += p.price * cart[sku];
                cont.innerHTML += `<div class="flex justify-between items-center bg-white/5 p-3 rounded-xl">
                    <span class="text-xs max-w-[200px]">${p.name}</span>
                    <span class="font-bold">${cart[sku]} —à—Ç.</span>
                </div>`;
            }
            document.getElementById('final-price').innerText = total + " –≥—Ä–Ω";
        }
 
        async function checkout() {
            if(Object.keys(cart).length === 0) return;
            const phone = prompt("–í–≤–µ–¥—ñ—Ç—å –≤–∞—à –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω—É:");
            if(!phone) return;
            
            let msg = `üõçÔ∏è –ó–ê–ú–û–í–õ–ï–ù–ù–Ø –¢–ï–õ: ${phone}\n\n`;
            for (let sku in cart) {
                const p = products.find(i => i.sku === sku);
                msg += `${p.name} - ${cart[sku]} —à—Ç.\n`;
            }
            msg += `\n–†–ê–ó–û–ú: ${document.getElementById('final-price').innerText}`;
            
            await fetch(`https://api.telegram.org/bot6918546766:AAEWLatU6fz6ITX8OI81Hd6nrMc-jE8u5cU/sendMessage?chat_id=1246930818&text=${encodeURIComponent(msg)}`);
            alert("–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!");
            cart = {}; localStorage.removeItem('trend_cart'); location.reload();
        }
 
        function updateSettings() {
            settings.markup = document.getElementById('markup').value;
            settings.discount = document.getElementById('global-discount').value;
            localStorage.setItem('trend_settings', JSON.stringify(settings));
            init();
        }
 
        function loginAdmin() { if(prompt("Pass:") === "admin123") document.getElementById('admin-panel').classList.toggle('hidden'); }
        function toggleCart() { document.getElementById('cart-modal').classList.toggle('hidden'); updateCartUI(); }
        window.onload = init;
    </script>
</body>
</html>
