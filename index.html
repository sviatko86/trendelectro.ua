<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trend Electro ‚Äî –û–ø—Ç–æ–≤–∏–π –ø—Ä–∞–π—Å (Admin Mode)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .cart-badge { position: absolute; top: -8px; right: -8px; background: red; color: white; border-radius: 50%; padding: 2px 6px; font-size: 10px; }
        .admin-only { display: none; background: #fef3c7; border: 2px dashed #f59e0b; }
        .hidden { display: none; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <nav class="bg-yellow-500 p-4 sticky top-0 z-50 shadow-lg">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white tracking-tighter">TREND ELECTRO</h1>
            <div class="flex gap-6 items-center">
                <button onclick="loginAdmin()" class="text-white opacity-20 hover:opacity-100 transition"><i class="fas fa-lock"></i></button>
                <button onclick="toggleCabinet()" class="text-white text-xl"><i class="fas fa-user-circle"></i></button>
                <button onclick="toggleCart()" class="relative text-white text-xl">
                    <i class="fas fa-shopping-cart"></i>
                    <span id="cart-count" class="cart-badge">0</span>
                </button>
            </div>
        </div>
    </nav>

    <div class="container mx-auto p-4">
        
        <div id="admin-panel" class="admin-only p-6 rounded-xl mb-6">
            <div class="flex justify-between items-center">
                <h2 class="text-xl font-black text-yellow-800"><i class="fas fa-tools"></i> –ü–ê–ù–ï–õ–¨ –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ê</h2>
                <button onclick="logoutAdmin()" class="text-red-600 font-bold underline">–í–∏–π—Ç–∏</button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-4">
                <div class="bg-white p-4 rounded shadow">
                    <p class="text-gray-500 text-sm">–¢–æ–≤–∞—Ä—ñ–≤ —É –±–∞–∑—ñ:</p>
                    <p id="stat-count" class="text-2xl font-bold">0</p>
                </div>
                <div class="bg-white p-4 rounded shadow">
                    <p class="text-gray-500 text-sm">–ü–æ—Ç–æ—á–Ω–µ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è:</p>
                    <p id="stat-total" class="text-2xl font-bold text-green-600">0 –≥—Ä–Ω</p>
                </div>
                <div class="bg-white p-4 rounded shadow">
                    <button onclick="alert('–ï–∫—Å–ø–æ—Ä—Ç —É Excel —Å–∫–æ—Ä–æ –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π!')" class="w-full h-full bg-yellow-400 font-bold rounded">–ï–∫—Å–ø–æ—Ä—Ç –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</button>
                </div>
            </div>
        </div>

        <div class="mb-6">
            <input type="text" id="search" placeholder="–ü–æ—à—É–∫ —Ç–æ–≤–∞—Ä—É –∑–∞ –Ω–∞–∑–≤–æ—é –∞–±–æ –∞—Ä—Ç–∏–∫—É–ª–æ–º..." 
                class="w-full p-4 rounded-xl border-2 border-yellow-400 focus:outline-none focus:ring-2 ring-yellow-200 shadow-sm text-lg">
        </div>

        <div id="cabinet" class="hidden bg-white p-6 rounded-xl shadow-md mb-6 border-t-4 border-yellow-500">
            <h2 class="text-xl font-bold mb-4">–ö–∞–±—ñ–Ω–µ—Ç –ö–ª—ñ—î–Ω—Ç–∞ (–î–∏—Å–∫–æ–Ω—Ç)</h2>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <input type="text" id="user-name" placeholder="–í–∞—à–µ –Ü–º'—è / –ö–æ–º–ø–∞–Ω—ñ—è" class="p-3 border rounded-lg">
                <input type="text" id="user-phone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω" class="p-3 border rounded-lg">
                <button onclick="saveProfile()" class="bg-green-600 text-white px-6 py-2 rounded-lg font-bold hover:bg-green-700">–ó–±–µ—Ä–µ–≥—Ç–∏</button>
            </div>
        </div>

        <div class="bg-white rounded-xl shadow-xl overflow-hidden">
            <div class="overflow-x-auto">
                <table class="w-full text-left">
                    <thead class="bg-gray-100 border-b">
                        <tr>
                            <th class="p-4">–ö–æ–¥</th>
                            <th class="p-4">–ù–∞–∑–≤–∞ —Ç–æ–≤–∞—Ä—É</th>
                            <th class="p-4">–¶—ñ–Ω–∞ (–≥—Ä–Ω)</th>
                            <th class="p-4 text-center">–ó–∞–º–æ–≤–∏—Ç–∏</th>
                        </tr>
                    </thead>
                    <tbody id="product-list"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="cart-modal" class="hidden fixed inset-0 bg-black bg-opacity-60 z-[60] flex justify-end">
        <div class="bg-white w-full max-w-md h-full p-6 overflow-y-auto shadow-2xl transition-all">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-yellow-600">–ö–æ—à–∏–∫ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è</h2>
                <button onclick="toggleCart()" class="text-4xl text-gray-400">&times;</button>
            </div>
            <div id="cart-items" class="space-y-4"></div>
            
            <div class="border-t mt-8 pt-6">
                <div class="flex justify-between text-lg"><span>–°—É–º–∞:</span><span id="total-price">0 –≥—Ä–Ω</span></div>
                <div id="discount-info" class="text-green-600 font-bold text-sm"></div>
                <div class="flex justify-between text-3xl font-black mt-2 text-red-600">
                    <span>–í–°–¨–û–ì–û:</span><span id="final-price">0 –≥—Ä–Ω</span>
                </div>
                <button onclick="checkout()" class="w-full bg-green-500 text-white py-4 rounded-xl mt-8 font-bold text-xl hover:bg-green-600 shadow-lg">
                    –í–Ü–î–ü–†–ê–í–ò–¢–ò –í TELEGRAM
                </button>
            </div>
        </div>
    </div>

    <script>
        let products = [];
        let cart = {};
        let isAdmin = false;

        async function loadProducts() {
            try {
                const response = await fetch('data.csv');
                const data = await response.text();
                const lines = data.split('\n').filter(l => l.trim() !== "");
                
                products = lines.slice(1).map(line => {
                    const parts = line.split(',');
                    const sku = parts[0];
                    const price = parseFloat(parts[parts.length - 1]);
                    const name = parts.slice(1, -1).join(' '); // –°–∫–ª–µ—é—î–º–æ –Ω–∞–∑–≤—É, —è–∫—â–æ —Ç–∞–º –±—É–ª–∏ –∫–æ–º–∏
                    return { sku, name, price };
                }).filter(p => p.sku && !isNaN(p.price));

                document.getElementById('stat-count').innerText = products.length;
                renderProducts(products);
            } catch (e) { alert("–ü–æ–º–∏–ª–∫–∞: –§–∞–π–ª data.csv –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ!"); }
        }

        function renderProducts(items) {
            const list = document.getElementById('product-list');
            list.innerHTML = items.map(p => `
                <tr class="border-b hover:bg-yellow-50 transition">
                    <td class="p-4 text-xs font-mono text-gray-400">${p.sku}</td>
                    <td class="p-4 font-semibold">${p.name}</td>
                    <td class="p-4">
                        ${isAdmin ? `<input type="number" value="${p.price}" onchange="changePrice('${p.sku}', this.value)" class="w-20 border p-1 rounded bg-yellow-100">` : `<span class="font-bold text-yellow-700">${p.price}</span>`}
                    </td>
                    <td class="p-4">
                        <div class="flex items-center justify-center gap-3 bg-gray-100 rounded-full p-1">
                            <button onclick="updateCart('${p.sku}', -1)" class="w-8 h-8 flex items-center justify-center bg-white rounded-full shadow hover:bg-red-100">-</button>
                            <span id="qty-${p.sku}" class="font-bold w-6 text-center text-lg">${cart[p.sku] || 0}</span>
                            <button onclick="updateCart('${p.sku}', 1)" class="w-8 h-8 flex items-center justify-center bg-yellow-400 rounded-full shadow hover:bg-yellow-500 text-white">+</button>
                        </div>
                    </td>
                </tr>
            `).join('');
        }

        function updateCart(sku, delta) {
            cart[sku] = (cart[sku] || 0) + delta;
            if (cart[sku] <= 0) delete cart[sku];
            if (document.getElementById(`qty-${sku}`)) document.getElementById(`qty-${sku}`).innerText = cart[sku] || 0;
            updateCartUI();
        }

        function updateCartUI() {
            const count = Object.values(cart).reduce((a, b) => a + b, 0);
            document.getElementById('cart-count').innerText = count;
            
            let total = 0;
            const container = document.getElementById('cart-items');
            container.innerHTML = '';

            for (let sku in cart) {
                const p = products.find(i => i.sku === sku);
                const sum = p.price * cart[sku];
                total += sum;
                container.innerHTML += `
                    <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                        <div class="flex-1 pr-4"><p class="font-bold text-sm">${p.name}</p></div>
                        <div class="text-right">
                            <p class="font-bold text-yellow-600">${sum.toFixed(2)}</p>
                            <p class="text-xs text-gray-400">${cart[sku]} x ${p.price}</p>
                        </div>
                    </div>
                `;
            }

            let discount = total >= 10000 ? 0.05 : (total >= 5000 ? 0.03 : 0);
            let final = total * (1 - discount);
            
            document.getElementById('total-price').innerText = total.toFixed(2) + " –≥—Ä–Ω";
            document.getElementById('final-price').innerText = final.toFixed(2) + " –≥—Ä–Ω";
            document.getElementById('stat-total').innerText = final.toFixed(2) + " –≥—Ä–Ω";
            document.getElementById('discount-info').innerText = discount > 0 ? `–ó–Ω–∏–∂–∫–∞ ${(discount*100).toFixed(0)}% –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–∞!` : "";
        }

        function loginAdmin() {
            let pass = prompt("–í–≤–µ–¥—ñ—Ç—å –ø–∞—Ä–æ–ª—å –∞–¥–º—ñ–Ω–∞:");
            if (pass === "admin123") {
                isAdmin = true;
                document.getElementById('admin-panel').style.display = 'block';
                renderProducts(products);
                alert("–†–µ–∂–∏–º –∞–¥–º—ñ–Ω–∞ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!");
            } else { alert("–ù–µ–≤—ñ—Ä–Ω–∏–π –ø–∞—Ä–æ–ª—å!"); }
        }

        function logoutAdmin() {
            isAdmin = false;
            document.getElementById('admin-panel').style.display = 'none';
            renderProducts(products);
        }

        function changePrice(sku, newPrice) {
            const p = products.find(i => i.sku === sku);
            if (p) {
                p.price = parseFloat(newPrice);
                updateCartUI();
            }
        }

        function checkout() {
            const user = JSON.parse(localStorage.getItem('trend_user') || '{}');
            let msg = `üõí Trend Electro: –ó–ê–ú–û–í–õ–ï–ù–ù–Ø\nüë§ –ö–ª—ñ—î–Ω—Ç: ${user.name || '–ì—ñ—Å—Ç—å'}\nüìû –¢–µ–ª: ${user.phone || '-'}\n\n`;
            for (let sku in cart) {
                const p = products.find(i => i.sku === sku);
                msg += `üîπ ${p.name} | ${cart[sku]} —à—Ç. = ${ (p.price * cart[sku]).toFixed(2) }\n`;
            }
            msg += `\nüî• –†–ê–ó–û–ú: ${document.getElementById('final-price').innerText}`;
            window.open(`https://t.me/share/url?url=${encodeURIComponent(msg)}`, '_blank');
        }

        document.getElementById('search').addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            renderProducts(products.filter(p => p.name.toLowerCase().includes(term) || p.sku.toLowerCase().includes(term)));
        });

        function saveProfile() {
            localStorage.setItem('trend_user', JSON.stringify({ name: document.getElementById('user-name').value, phone: document.getElementById('user-phone').value }));
            alert("–ü—Ä–æ—Ñ—ñ–ª—å –∑–±–µ—Ä–µ–∂–µ–Ω–æ!");
        }

        function toggleCart() { document.getElementById('cart-modal').classList.toggle('hidden'); }
        function toggleCabinet() { document.getElementById('cabinet').classList.toggle('hidden'); }

        window.onload = loadProducts;
    </script>
</body>
</html>
